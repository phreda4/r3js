<!DOCTYPE html>
<html>
  <head>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.40.2/codemirror.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.40.2/codemirror.js"></script>
    
    <script src="./compiler.js"></script>
    <script src="./r3www.js"></script>    
    
    <script>
    function r3Compile() {
      var code = document.getElementById("srccode").textContent;
      r3tokenizer(code);
    }
    function dumpVM() {
      const setDiv = (id, contents) => {
        document.getElementById(id).innerHTML = contents;
      };
      const mkDiv = text => `<div>${text}</div>`;
      setDiv("ip", [ip].map(mkDiv));
      setDiv("ds", [TOS, ...(dpila.slice(2, NOS+1))].map(mkDiv).join(""));
      setDiv("cs", rpila.slice(1, RTOS).map(mkDiv).join(""));
      setDiv("mc", [...memcode.slice(0, memc)].map(mkDiv).join(""));
      setDiv("md", [...memdata.slice(0, memd)].map(mkDiv).join(","));
    }
    </script>
  </head>
  <body>
    <H2>r3</H2>
    <textarea id="srccode">1 2 3 + - 
:cua dup * ;
5 cua 
    </textarea><br>
    <button onclick="r3Compile();dumpVM();">COMPILE</button>    
    <button onclick="r3step();dumpVM();">Step</button>
    <br><br>
    DATA STACK:<div id="ds"></div><br>
    CODE STACK:<div id="cs"></div><br>
    <br>    
    IP:<div id="ip"></div><br>    
    MEMCODE:<div id="mc"></div><br>
    MEMDATA:<div id="md"></div><br>

    <script>
    var editor = CodeMirror.fromTextArea(document.getElementById("srccode"), {
      lineNumbers: true
    });
    </script>
</body>
</html>